package org.opentestmodeling.vstepngt.plugins.sonarqube;

import java.io.File;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.sonar.api.batch.Sensor;
import org.sonar.api.batch.SensorContext;
import org.sonar.api.batch.fs.FileSystem;
import org.sonar.api.measures.Measure;
import org.sonar.api.resources.Project;

import org.opentestmodeling.vstepngt.plugins.sonarqube.analyzers.AnalyzerException;
import org.opentestmodeling.vstepngt.plugins.sonarqube.analyzers.VstepNgtAnalyzer;

/**
 */
public class VstepNgtSensor implements Sensor {

    private final FileSystem fileSystem;

    private final Logger log = LoggerFactory.getLogger(this.getClass());

    /**
     * @param fileSystem the project file system
     */
    public VstepNgtSensor(FileSystem fileSystem) {
        this.fileSystem = fileSystem;
    }

    @Override
    public boolean shouldExecuteOnProject(Project project) {
        // this sensor is executed on any type of project
        return true;
    }

    @Override
    public void analyse(Project project, SensorContext sensorContext) {

        File rootDir = fileSystem.baseDir();

        log.info("Analysing project root in search for IDE Metadata files: " + rootDir.getAbsolutePath());

        VstepNgtAnalyzer analyzer = new VstepNgtAnalyzer(rootDir);

//        try {
//            //TODO analyzer.analyze();
//
//        } catch (AnalyzerException ae) {
//            log.error("Failed to analyze", ae);
//        }
    }

    public String toString() {
        return "VstepNgtSensor";
    }
}
